#!/bin/bash

# Test if images (with "-->") without anchortext are correctly embedded.
# Here in the form of a Ralph/Xueyuan link.

trap 'rm $TMP1 $TMP2 $TMP3' 0
TMP1=`mktemp /tmp/topics-XXXXXX` || exit 1
TMP2=`mktemp /tmp/topics-XXXXXX` || exit 1
TMP3=`mktemp /tmp/topics-XXXXXX` || exit 1

url="https://www.w3.org/Icons/w3c_48x48.png"

# Expected line:
echo "<section><p class=irc><cite>&lt;foo&gt;</cite> <a href=\"$url\"><span class=image><img src=\"$url\" alt=\"[image]\"> </span></a></p>" >$TMP1

# Get the generated line:
echo -e "<foo> scribenick:bar\n<foo> --> $url" | perl scribe.perl >$TMP3
# cat $TMP3
grep "$url" $TMP3 >$TMP2

# Compare:
diff -u $TMP1 $TMP2
